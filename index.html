<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>WhatsApp Enhanced v3 - Personalization System</title>\n    <!-- Bootstrap CSS -->\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <!-- Font Awesome -->\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\n    <!-- Custom CSS -->\n    <link rel=\"stylesheet\" href=\"/public/styles.css\">\n    <style>\n        /* Ensure the page is visible even if CSS fails to load */\n        body {\n            font-family: Arial, sans-serif;\n            background-color: #f8f9fa;\n            min-height: 100vh;\n        }\n        .navbar {\n            background-color: #25d366 !important;\n        }\n        .sidebar {\n            background-color: #ffffff;\n            border-right: 1px solid #dee2e6;\n            min-height: 90vh;\n        }\n        .main-content {\n            background-color: #ffffff;\n            min-height: 90vh;\n        }\n        #qrSection {\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            color: white;\n            min-height: 400px;\n        }\n        .h-100 {\n            min-height: 100vh;\n        }\n    </style>\n</head>\n<body>\n    <!-- Loading Indicator -->\n    <div id=\"loadingIndicator\" style=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center;\">\n        <div class=\"text-center\">\n            <div class=\"spinner-border text-success\" role=\"status\">\n                <span class=\"visually-hidden\">Loading...</span>\n            </div>\n            <p class=\"mt-2\">Loading WhatsApp Enhanced v3...</p>\n        </div>\n    </div>\n\n    <!-- Navigation -->\n    <nav class=\"navbar navbar-dark bg-success\">\n        <div class=\"container-fluid\">\n            <span class=\"navbar-brand mb-0 h1\">\n                <i class=\"fab fa-whatsapp\"></i> WhatsApp Enhanced v3\n            </span>\n            <div class=\"d-flex align-items-center\">\n                <span id=\"connectionStatus\" class=\"badge bg-danger me-2\">Disconnected</span>\n                <button class=\"btn btn-outline-light btn-sm\" id=\"refreshBtn\">\n                    <i class=\"fas fa-sync-alt\"></i> Refresh\n                </button>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container-fluid\">\n        <div class=\"row\">\n            <!-- Sidebar -->\n            <div class=\"col-md-3 p-0 sidebar\">\n                <div class=\"d-flex flex-column h-100\">\n                    <!-- Tabs -->\n                    <ul class=\"nav nav-tabs\" id=\"sidebarTabs\" role=\"tablist\">\n                        <li class=\"nav-item\" role=\"presentation\">\n                            <button class=\"nav-link active\" id=\"chats-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#chats\" \n                                    type=\"button\" role=\"tab\" aria-controls=\"chats\" aria-selected=\"true\">\n                                <i class=\"fas fa-comments\"></i> Chats\n                            </button>\n                        </li>\n                        <li class=\"nav-item\" role=\"presentation\">\n                            <button class=\"nav-link\" id=\"contacts-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#contacts\" \n                                    type=\"button\" role=\"tab\" aria-controls=\"contacts\" aria-selected=\"false\">\n                                <i class=\"fas fa-users\"></i> Contacts\n                            </button>\n                        </li>\n                        <li class=\"nav-item\" role=\"presentation\">\n                            <button class=\"nav-link\" id=\"personalization-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#personalization\" \n                                    type=\"button\" role=\"tab\" aria-controls=\"personalization\" aria-selected=\"false\">\n                                <i class=\"fas fa-magic\"></i> Personalization\n                            </button>\n                        </li>\n                        <li class=\"nav-item\" role=\"presentation\">\n                            <button class=\"nav-link\" id=\"tools-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#tools\" \n                                    type=\"button\" role=\"tab\" aria-controls=\"tools\" aria-selected=\"false\">\n                                <i class=\"fas fa-tools\"></i> Tools\n                            </button>\n                        </li>\n                    </ul>\n\n                    <!-- Tab Content -->\n                    <div class=\"tab-content flex-grow-1\" id=\"sidebarTabContent\">\n                        <!-- Chats Tab -->\n                        <div class=\"tab-pane fade show active\" id=\"chats\" role=\"tabpanel\" aria-labelledby=\"chats-tab\">\n                            <div class=\"p-3\">\n                                <div class=\"search-box mb-3\">\n                                    <input type=\"text\" class=\"form-control\" id=\"chatSearch\" placeholder=\"Search chats...\">\n                                </div>\n                                <div id=\"chatsList\" class=\"chats-list\">\n                                    <div class=\"text-center text-muted py-3\">Loading chats...</div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Contacts Tab -->\n                        <div class=\"tab-pane fade\" id=\"contacts\" role=\"tabpanel\" aria-labelledby=\"contacts-tab\">\n                            <div class=\"p-3\">\n                                <div class=\"search-box mb-3\">\n                                    <input type=\"text\" class=\"form-control\" id=\"contactSearch\" placeholder=\"Search contacts...\">\n                                </div>\n                                <div id=\"contactsList\" class=\"contacts-list\">\n                                    <div class=\"text-center text-muted py-3\">Loading contacts...</div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Personalization Tab -->\n                        <div class=\"tab-pane fade\" id=\"personalization\" role=\"tabpanel\" aria-labelledby=\"personalization-tab\">\n                            <div class=\"p-3\">\n                                <div class=\"d-flex flex-column\">\n                                    <!-- Header -->\n                                    <div class=\"mb-3\">\n                                        <h5 class=\"mb-2\">\n                                            <i class=\"fas fa-magic text-primary\"></i> Message Personalization\n                                        </h5>\n                                        <p class=\"text-muted small mb-0\">Create personalized messages with dynamic tokens</p>\n                                    </div>\n\n                                    <!-- Token Insertion -->\n                                    <div class=\"mb-3\">\n                                        <label class=\"form-label small fw-bold\">Available Tokens</label>\n                                        <div id=\"tokenButtons\" class=\"mb-2\">\n                                            <button class=\"btn btn-outline-primary btn-sm me-1 mb-1 token-btn\" data-token=\"{{name}}\">\n                                                <i class=\"fas fa-plus-circle me-1\"></i>{{name}}\n                                            </button>\n                                            <button class=\"btn btn-outline-primary btn-sm me-1 mb-1 token-btn\" data-token=\"{{phone}}\">\n                                                <i class=\"fas fa-plus-circle me-1\"></i>{{phone}}\n                                            </button>\n                                            <button class=\"btn btn-outline-primary btn-sm me-1 mb-1 token-btn\" data-token=\"{{email}}\">\n                                                <i class=\"fas fa-plus-circle me-1\"></i>{{email}}\n                                            </button>\n                                            <button class=\"btn btn-outline-primary btn-sm me-1 mb-1 token-btn\" data-token=\"{{company}}\">\n                                                <i class=\"fas fa-plus-circle me-1\"></i>{{company}}\n                                            </button>\n                                        </div>\n                                        <small class=\"text-muted\">Click tokens to insert into your message</small>\n                                    </div>\n\n                                    <!-- Message Composer -->\n                                    <div class=\"mb-3\">\n                                        <label class=\"form-label small fw-bold\">Message Content</label>\n                                        <textarea class=\"form-control\" id=\"personalizedMessage\" rows=\"4\" \n                                                placeholder=\"Type your personalized message here... Use tokens like {{name}} for dynamic content.\"></textarea>\n                                    </div>\n\n                                    <!-- Recipient Selection -->\n                                    <div class=\"mb-3\">\n                                        <label class=\"form-label small fw-bold\">Recipients</label>\n                                        <select class=\"form-select form-select-sm mb-2\" id=\"recipientType\">\n                                            <option value=\"single\">Single Contact</option>\n                                            <option value=\"multiple\">Multiple Contacts</option>\n                                            <option value=\"all\">All Contacts</option>\n                                        </select>\n                                        \n                                        <!-- Single Contact Selector -->\n                                        <div id=\"singleSelector\" class=\"recipient-selector\">\n                                            <select class=\"form-select form-select-sm\" id=\"contactSelector\">\n                                                <option value=\"\">Select a contact...</option>\n                                            </select>\n                                        </div>\n\n                                        <!-- Multiple Contacts Selector -->\n                                        <div id=\"multipleSelector\" class=\"recipient-selector\" style=\"display: none;\">\n                                            <div id=\"multipleContactsSelector\" style=\"max-height: 120px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.25rem; padding: 0.5rem;\">\n                                                <!-- Multiple contact checkboxes will be populated here -->\n                                            </div>\n                                        </div>\n\n                                        <!-- All Contacts Selector -->\n                                        <div id=\"allSelector\" class=\"recipient-selector\" style=\"display: none;\">\n                                            <div class=\"alert alert-info py-2\">\n                                                <i class=\"fas fa-info-circle\"></i> All contacts will be selected\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <!-- Message Preview -->\n                                    <div class=\"mb-3\">\n                                        <label class=\"form-label small fw-bold\">Preview</label>\n                                        <div id=\"messagePreview\" class=\"border rounded p-2\" style=\"max-height: 120px; overflow-y: auto; background-color: #f8f9fa;\">\n                                            <p class=\"text-muted mb-0\">Preview will appear here...</p>\n                                        </div>\n                                    </div>\n\n                                    <!-- Statistics -->\n                                    <div class=\"mb-3\">\n                                        <div class=\"row text-center\">\n                                            <div class=\"col-4\">\n                                                <div class=\"border rounded py-2\">\n                                                    <div class=\"fw-bold text-primary\" id=\"tokenCount\">0</div>\n                                                    <small class=\"text-muted\">Tokens</small>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-4\">\n                                                <div class=\"border rounded py-2\">\n                                                    <div class=\"fw-bold text-success\" id=\"recipientCount\">0</div>\n                                                    <small class=\"text-muted\">Recipients</small>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-4\">\n                                                <div class=\"border rounded py-2\">\n                                                    <div class=\"fw-bold text-warning\" id=\"estimatedMessages\">0</div>\n                                                    <small class=\"text-muted\">Messages</small>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <!-- Action Buttons -->\n                                    <div class=\"d-grid\">\n                                        <button class=\"btn btn-primary btn-sm\" id=\"sendPersonalizedBtn\">\n                                            <i class=\"fas fa-paper-plane\"></i> Send Personalized Messages\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- Tools Tab -->\n                        <div class=\"tab-pane fade\" id=\"tools\" role=\"tabpanel\" aria-labelledby=\"tools-tab\">\n                            <div class=\"p-3\">\n                                <div class=\"accordion\" id=\"toolsAccordion\">\n                                    <!-- Templates -->\n                                    <div class=\"accordion-item\">\n                                        <h2 class=\"accordion-header\">\n                                            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" \n                                                    data-bs-target=\"#templatesCollapse\" aria-expanded=\"true\" \n                                                    aria-controls=\"templatesCollapse\">\n                                                <i class=\"fas fa-file-alt me-2\"></i> Message Templates\n                                            </button>\n                                        </h2>\n                                        <div id=\"templatesCollapse\" class=\"accordion-collapse collapse show\" \n                                             data-bs-parent=\"#toolsAccordion\">\n                                            <div class=\"accordion-body\">\n                                                <button class=\"btn btn-primary btn-sm mb-3\" id=\"addTemplateBtn\">\n                                                    <i class=\"fas fa-plus\"></i> Add Template\n                                                </button>\n                                                <div id=\"templatesList\">\n                                                    <div class=\"text-muted small\">No templates saved</div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    <!-- Bulk Messaging -->\n                                    <div class=\"accordion-item\">\n                                        <h2 class=\"accordion-header\">\n                                            <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" \n                                                    data-bs-target=\"#bulkMessagingCollapse\" aria-expanded=\"false\" \n                                                    aria-controls=\"bulkMessagingCollapse\">\n                                                <i class=\"fas fa-broadcast-tower me-2\"></i> Bulk Messaging\n                                            </button>\n                                        </h2>\n                                        <div id=\"bulkMessagingCollapse\" class=\"accordion-collapse collapse\" \n                                             data-bs-parent=\"#toolsAccordion\">\n                                            <div class=\"accordion-body\">\n                                                <button class=\"btn btn-warning btn-sm\" id=\"bulkMessageBtn\">\n                                                    <i class=\"fas fa-paper-plane\"></i> Send Bulk Message\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Main Chat Area -->\n            <div class=\"col-md-9 p-0 main-content\">\n                <div class=\"d-flex flex-column h-100\">\n                    <!-- QR Code Section -->\n                    <div id=\"qrSection\" class=\"d-flex justify-content-center align-items-center\" style=\"min-height: 500px;\">\n                        <div class=\"text-center\">\n                            <h3 class=\"mb-4 text-white\">Scan QR Code to Connect</h3>\n                            <div id=\"qrCodeContainer\" class=\"mb-3\">\n                                <div class=\"d-flex justify-content-center align-items-center\" style=\"min-height: 200px; background: white; border-radius: 10px; padding: 20px;\">\n                                    <div class=\"spinner-border text-primary\" role=\"status\">\n                                        <span class=\"visually-hidden\">Loading QR Code...</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <p class=\"text-white\">\n                                <i class=\"fas fa-mobile-alt me-2\"></i>\n                                Open WhatsApp on your phone → Settings → Linked Devices → Link a Device\n                            </p>\n                        </div>\n                    </div>\n\n                    <!-- Chat Header -->\n                    <div id=\"chatHeader\" class=\"chat-header bg-light border-bottom p-3\" style=\"display: none;\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"chat-avatar me-3\">\n                                <i class=\"fas fa-user-circle fa-2x text-secondary\"></i>\n                            </div>\n                            <div class=\"flex-grow-1\">\n                                <h6 class=\"mb-0\" id=\"chatName\">Select a contact to start messaging</h6>\n                                <small class=\"text-muted\" id=\"chatStatus\">Click on a contact</small>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Messages Area -->\n                    <div id=\"messagesArea\" class=\"messages-area flex-grow-1 p-3\" style=\"display: none;\">\n                        <div id=\"messagesList\" class=\"messages-list\">\n                            <!-- Messages will be populated here -->\n                        </div>\n                    </div>\n\n                    <!-- Message Input -->\n                    <div id=\"messageInput\" class=\"message-input bg-light border-top p-3\" style=\"display: none;\">\n                        <div class=\"row g-2\">\n                            <div class=\"col\">\n                                <div class=\"input-group\">\n                                    <input type=\"text\" class=\"form-control\" id=\"messageText\" \n                                           placeholder=\"Type a message...\" maxlength=\"4096\">\n                                    <button class=\"btn btn-success\" type=\"button\" id=\"sendBtn\">\n                                        <i class=\"fas fa-paper-plane\"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Welcome Screen -->\n                    <div id=\"welcomeScreen\" class=\"d-flex justify-content-center align-items-center h-100\" style=\"display: none;\">\n                        <div class=\"text-center\">\n                            <i class=\"fab fa-whatsapp fa-5x text-success mb-4\"></i>\n                            <h2>WhatsApp Enhanced v3</h2>\n                            <p class=\"text-muted\">Advanced personalization system with bulk messaging.</p>\n                            <p class=\"text-muted\">Select a contact or use the Personalization tab.</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Scripts -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js\"></script>\n    \n    <script>\n        // Hide loading indicator once page is loaded\n        document.addEventListener('DOMContentLoaded', function() {\n            const loadingIndicator = document.getElementById('loadingIndicator');\n            if (loadingIndicator) {\n                setTimeout(() => {\n                    loadingIndicator.style.display = 'none';\n                }, 1000);\n            }\n        });\n        \n        // Test if basic elements are working\n        console.log('Page loaded, DOM ready');\n    </script>\n    \n    <script src=\"/public/PersonalizationManager.js\"></script>\n    <script src=\"/public/app.js\"></script>\n</body>\n</html>"